# PRS_2024_GRP1
Group Project for the 2024 Uganda PRS Workshop

## 1. LOAD THE DATA INTO R 
```
## 1. LOAD THE DATA
the.data <- read.csv('data/monodta.txt',header=TRUE,sep=" ")
the.data <- tibble::as_tibble(the.data)
str(the.data)
```
### Output:
```
 > tibble [1,564 × 35] (S3: tbl_df/tbl/data.frame)
 $ PID      : chr [1:1564] "000" "001" "002" "003" ...
 $ mono     : num [1:1564] 5.3 5.3 5 6.2 5.5 ...
 $ PGS000102: num [1:1564] 3.26e-05 2.84e-05 3.15e-05 2.46e-05 2.28e-05 ...
 $ PGS000177: num [1:1564] 0.0148 0.0147 0.0145 0.0142 0.014 ...
 $ PGS001163: num [1:1564] -2.77e-06 -1.32e-06 -6.98e-06 -2.33e-06 -4.36e-06 ...
 $ PGS001968: num [1:1564] -2.52e-06 -3.31e-06 -3.98e-06 -4.99e-06 -4.80e-06 ...
 $ PGS002186: num [1:1564] -1.17e-07 -1.66e-07 -2.33e-07 -2.82e-07 -3.20e-07 ...
 $ PGS002341: num [1:1564] 1.97e-07 2.80e-07 3.07e-07 -1.16e-07 1.35e-07 ...
 $ PGS002372: num [1:1564] -3.15e-08 -8.01e-09 4.07e-07 3.36e-07 -2.33e-07 ...
 $ PGS002413: num [1:1564] 0.00367 0.00277 0.00353 0.00314 0.00327 ...
 $ PGS002462: num [1:1564] 0.01024 0.00863 0.00987 0.00951 0.00857 ...
 $ PGS002511: num [1:1564] 0.0166 0.017 0.0172 0.016 0.0171 ...
 $ PGS002560: num [1:1564] 0.00194 0.00191 0.00192 0.00153 0.00171 ...
 $ PGS002609: num [1:1564] 0.00236 0.00249 0.00241 0.00189 0.00211 ...
 $ PGS002658: num [1:1564] 1.73e-06 2.25e-06 1.32e-06 9.58e-07 8.59e-07 ...
 $ PGS002707: num [1:1564] -6.11e-07 -8.45e-07 -6.98e-07 -9.85e-07 -9.16e-07 ...
 $ PGS003544: num [1:1564] -4.91e-09 -5.48e-09 -6.94e-08 -1.32e-07 -1.53e-07 ...
 $ PGS003937: num [1:1564] -7.83e-06 -3.61e-06 -8.14e-06 -8.94e-06 -8.60e-06 ...
 $ PGS004357: num [1:1564] -1.30e-07 4.79e-08 -1.08e-07 -3.13e-07 -2.73e-07 ...
 $ PGS004801: num [1:1564] -3.46e-07 -4.75e-07 -9.53e-07 -1.59e-06 -2.47e-07 ...
 $ PGS004802: num [1:1564] 4.31e-07 4.35e-07 2.69e-07 -1.55e-07 4.30e-07 ...
 $ PGS004803: num [1:1564] -1.48e-06 -1.16e-06 -1.74e-06 -2.13e-06 -1.50e-06 ...
 $ PGS004804: num [1:1564] 4.31e-07 4.35e-07 2.69e-07 -1.55e-07 4.30e-07 ...
 $ sex      : int [1:1564] 2 1 2 2 2 2 2 2 1 1 ...
 $ age      : num [1:1564] 29.2 14.1 26.1 51.1 25.4 ...
 $ PC1      : num [1:1564] -0.00246 0.00478 -0.00642 0.05269 -0.00808 ...
 $ PC2      : num [1:1564] -0.002855 -0.000314 -0.003474 0.017146 -0.004482 ...
 $ PC3      : num [1:1564] 0.00141 0.00229 0.00222 -0.00182 0.00491 ...
 $ PC4      : num [1:1564] -0.00225 -0.00407 -0.00284 -0.0033 -0.00648 ...
 $ PC5      : num [1:1564] 0.001597 0.000574 0.000619 0.006278 0.001456 ...
 $ PC6      : num [1:1564] -0.0003 -0.011835 -0.000419 -0.011901 -0.003367 ...
 $ PC7      : num [1:1564] 0.00115 -0.00255 0.00152 -0.00305 0.00121 ...
 $ PC8      : num [1:1564] -0.002475 0.000794 -0.001765 0.00175 -0.007381 ...
 $ PC9      : num [1:1564] -0.00204 -0.00014 -0.00145 0.00535 -0.00583 ...
 $ PC10     : num [1:1564] 0.000477 -0.008972 -0.000794 0.00336 0.005379 ...
```


## 2. SELECT ONLY THE COLUMNS WITH PRS 
```
the.data.prs <- the.data[,c(2:23)]
head(the.data.prs)
str(the.data.prs)
```
### Output:
```
> tibble [1,564 × 22] (S3: tbl_df/tbl/data.frame)
 $ mono     : num [1:1564] 5.3 5.3 5 6.2 5.5 ...
 $ PGS000102: num [1:1564] 3.26e-05 2.84e-05 3.15e-05 2.46e-05 2.28e-05 ...
 $ PGS000177: num [1:1564] 0.0148 0.0147 0.0145 0.0142 0.014 ...
 $ PGS001163: num [1:1564] -2.77e-06 -1.32e-06 -6.98e-06 -2.33e-06 -4.36e-06 ...
 $ PGS001968: num [1:1564] -2.52e-06 -3.31e-06 -3.98e-06 -4.99e-06 -4.80e-06 ...
 $ PGS002186: num [1:1564] -1.17e-07 -1.66e-07 -2.33e-07 -2.82e-07 -3.20e-07 ...
 $ PGS002341: num [1:1564] 1.97e-07 2.80e-07 3.07e-07 -1.16e-07 1.35e-07 ...
 $ PGS002372: num [1:1564] -3.15e-08 -8.01e-09 4.07e-07 3.36e-07 -2.33e-07 ...
 $ PGS002413: num [1:1564] 0.00367 0.00277 0.00353 0.00314 0.00327 ...
 $ PGS002462: num [1:1564] 0.01024 0.00863 0.00987 0.00951 0.00857 ...
 $ PGS002511: num [1:1564] 0.0166 0.017 0.0172 0.016 0.0171 ...
 $ PGS002560: num [1:1564] 0.00194 0.00191 0.00192 0.00153 0.00171 ...
 $ PGS002609: num [1:1564] 0.00236 0.00249 0.00241 0.00189 0.00211 ...
 $ PGS002658: num [1:1564] 1.73e-06 2.25e-06 1.32e-06 9.58e-07 8.59e-07 ...
 $ PGS002707: num [1:1564] -6.11e-07 -8.45e-07 -6.98e-07 -9.85e-07 -9.16e-07 ...
 $ PGS003544: num [1:1564] -4.91e-09 -5.48e-09 -6.94e-08 -1.32e-07 -1.53e-07 ...
 $ PGS003937: num [1:1564] -7.83e-06 -3.61e-06 -8.14e-06 -8.94e-06 -8.60e-06 ...
 $ PGS004357: num [1:1564] -1.30e-07 4.79e-08 -1.08e-07 -3.13e-07 -2.73e-07 ...
 $ PGS004801: num [1:1564] -3.46e-07 -4.75e-07 -9.53e-07 -1.59e-06 -2.47e-07 ...
 $ PGS004802: num [1:1564] 4.31e-07 4.35e-07 2.69e-07 -1.55e-07 4.30e-07 ...
 $ PGS004803: num [1:1564] -1.48e-06 -1.16e-06 -1.74e-06 -2.13e-06 -1.50e-06 ...
 $ PGS004804: num [1:1564] 4.31e-07 4.35e-07 2.69e-07 -1.55e-07 4.30e-07 ...
```


## 3. SPLIT DATA 
```
smp_size <- floor(0.80 * nrow(the.data.prs))
set.seed(2000)
train_ind <- sample(seq_len(nrow(the.data.prs)), size = smp_size)
the.data.train <- the.data.prs[train_ind, ]
the.data.test <- the.data.prs[-train_ind, ]
```

## 4. TRAIN
```
cv_5 = trainControl(method = "cv", number = 5)
hit_elnet = train(
    mono ~ ., data = the.data.train,
    method = "glmnet",
    trControl = cv_5
)

hit_elnet
```
### Output:
```
> hit_elnet
glmnet 

1251 samples
  21 predictor

No pre-processing
Resampling: Cross-Validated (5 fold) 
Summary of sample sizes: 1001, 1001, 1002, 1000, 1000 
Resampling results across tuning parameters:

  alpha  lambda        RMSE      Rsquared    MAE     
  0.10   0.0004306852  1.778659  0.01138426  1.345145
  0.10   0.0043068520  1.778095  0.01155961  1.344762
  0.10   0.0430685203  1.773225  0.01287506  1.340818
  0.55   0.0004306852  1.778573  0.01142652  1.345095
  0.55   0.0043068520  1.776282  0.01208309  1.343430
  0.55   0.0430685203  1.767793  0.01294931  1.335410
  1.00   0.0004306852  1.778344  0.01148233  1.344938
  1.00   0.0043068520  1.774637  0.01255737  1.342008
  1.00   0.0430685203  1.767845  0.01041632  1.335118

RMSE was used to select the optimal model using the smallest value.
The final values used for the model were alpha = 0.55 and lambda = 0.04306852.
```


## 
```
hit_elnet_int = train(
    mono ~ . ^ 2, data = the.data.train,
    method = "glmnet",
    trControl = cv_5,
    tuneLength = 10
)

get_best_result = function(caret_fit) {
    best = which(rownames(caret_fit$results) == rownames(caret_fit$bestTune))
    best_result = caret_fit$results[best, ]
    rownames(best_result) = NULL
    best_result
}

get_best_result(hit_elnet_int)

```

## 5. TEST
```
set.seed(2000)
X = model.matrix(mono ~ . ^ 2, the.data.test)[, -1]
y = the.data.test$mono

fit_lasso_cv = cv.glmnet(X, y, alpha = 1)
sqrt(fit_lasso_cv$cvm[fit_lasso_cv$lambda == fit_lasso_cv$lambda.min]) # CV-RMSE minimum

coef(fit_lasso_cv)
sum(coef(fit_lasso_cv) != 0)
sum(coef(fit_lasso_cv) == 0)

```
